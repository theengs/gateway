<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Use | Theengs: BLE RF LoRa applications and MQTT gateways</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href=".apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Explore Theengs: the open-source platform that bridges hundreds of sensors and smart devices into one interface. Compatible with major IoT platforms and home automation systems like AWS, OpenHAB, Home Assistant, and Jeedom, Theengs simplifies your smart home experience. It supports MQTT protocol, enabling efficient integration and automation of devices. Theengs enhances interoperability of your your smart home or IoT ecosystem.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.25df7dd7.css" as="style"><link rel="preload" href="/assets/js/app.ad8a0d53.js" as="script"><link rel="preload" href="/assets/js/2.ab17224a.js" as="script"><link rel="preload" href="/assets/js/6.b0f7e920.js" as="script"><link rel="prefetch" href="/assets/js/10.f0f03117.js"><link rel="prefetch" href="/assets/js/11.17ec03df.js"><link rel="prefetch" href="/assets/js/12.8377b246.js"><link rel="prefetch" href="/assets/js/13.31e853f1.js"><link rel="prefetch" href="/assets/js/14.78ef65a3.js"><link rel="prefetch" href="/assets/js/15.2d3dfd7b.js"><link rel="prefetch" href="/assets/js/3.a323a9b7.js"><link rel="prefetch" href="/assets/js/4.a421501e.js"><link rel="prefetch" href="/assets/js/5.df79ec50.js"><link rel="prefetch" href="/assets/js/7.8f3e75b3.js"><link rel="prefetch" href="/assets/js/8.bf7d3dd1.js"><link rel="prefetch" href="/assets/js/9.a636cadf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25df7dd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Theengs: BLE RF LoRa applications and MQTT gateways</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.theengs.io" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Use cases" class="dropdown-title"><span class="title">Use cases</span> <span class="arrow down"></span></button> <button type="button" aria-label="Use cases" class="mobile-dropdown-title"><span class="title">Use cases</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/smarthome.html" target="_self" class="nav-link external">
  Smart Home
  <!----></a></li><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/iot.html" target="_self" class="nav-link external">
  IoT
  <!----></a></li><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/research.html" target="_self" class="nav-link external">
  Research
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Solutions" class="dropdown-title"><span class="title">Solutions</span> <span class="arrow down"></span></button> <button type="button" aria-label="Solutions" class="mobile-dropdown-title"><span class="title">Solutions</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Hardware
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://shop.theengs.io/products/theengs-plug-smart-plug-ble-gateway-and-energy-consumption" target="_self" class="nav-link external">
  Theengs Plug
  <!----></a></li><li class="dropdown-subitem"><a href="https://shop.theengs.io/products/theengs-bridge-esp32-ble-mqtt-gateway-with-ethernet-and-external-antenna" target="_self" class="nav-link external">
  Theengs Bridge
  <!----></a></li></ul></li><li class="dropdown-item"><h4>
          Software
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://app.theengs.io" target="_self" class="nav-link external">
  Mobile App
  <!----></a></li><li class="dropdown-subitem"><a href="https://docs.openmqttgateway.com" target="_self" class="nav-link external">
  OpenMQTTGateway
  <!----></a></li><li class="dropdown-subitem"><a href="https://gateway.theengs.io" target="_self" class="nav-link external">
  Gateway
  <!----></a></li></ul></li><li class="dropdown-item"><h4>
          Core
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://decoder.theengs.io" target="_self" class="nav-link external">
  Decoder
  <!----></a></li><li class="dropdown-subitem"><a href="https://parser.theengs.io" target="_self" class="nav-link external">
  Web Parser
  <!----></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://decoder.theengs.io/devices/devices.html" target="_self" class="nav-link external">
  Compatible devices
  <!----></a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://shop.theengs.io/" target="_self" class="nav-link external">
  Shop
  <!----></a></div><div class="nav-item"><a href="https://github.com/sponsors/theengs" target="_self" class="nav-link external">
  Sponsor ü§ç
  <!----></a></div> <a href="https://github.com/theengs/gateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.theengs.io" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Use cases" class="dropdown-title"><span class="title">Use cases</span> <span class="arrow down"></span></button> <button type="button" aria-label="Use cases" class="mobile-dropdown-title"><span class="title">Use cases</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/smarthome.html" target="_self" class="nav-link external">
  Smart Home
  <!----></a></li><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/iot.html" target="_self" class="nav-link external">
  IoT
  <!----></a></li><li class="dropdown-item"><!----> <a href="https://www.theengs.io/usecases/research.html" target="_self" class="nav-link external">
  Research
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Solutions" class="dropdown-title"><span class="title">Solutions</span> <span class="arrow down"></span></button> <button type="button" aria-label="Solutions" class="mobile-dropdown-title"><span class="title">Solutions</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Hardware
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://shop.theengs.io/products/theengs-plug-smart-plug-ble-gateway-and-energy-consumption" target="_self" class="nav-link external">
  Theengs Plug
  <!----></a></li><li class="dropdown-subitem"><a href="https://shop.theengs.io/products/theengs-bridge-esp32-ble-mqtt-gateway-with-ethernet-and-external-antenna" target="_self" class="nav-link external">
  Theengs Bridge
  <!----></a></li></ul></li><li class="dropdown-item"><h4>
          Software
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://app.theengs.io" target="_self" class="nav-link external">
  Mobile App
  <!----></a></li><li class="dropdown-subitem"><a href="https://docs.openmqttgateway.com" target="_self" class="nav-link external">
  OpenMQTTGateway
  <!----></a></li><li class="dropdown-subitem"><a href="https://gateway.theengs.io" target="_self" class="nav-link external">
  Gateway
  <!----></a></li></ul></li><li class="dropdown-item"><h4>
          Core
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://decoder.theengs.io" target="_self" class="nav-link external">
  Decoder
  <!----></a></li><li class="dropdown-subitem"><a href="https://parser.theengs.io" target="_self" class="nav-link external">
  Web Parser
  <!----></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://decoder.theengs.io/devices/devices.html" target="_self" class="nav-link external">
  Compatible devices
  <!----></a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://shop.theengs.io/" target="_self" class="nav-link external">
  Shop
  <!----></a></div><div class="nav-item"><a href="https://github.com/sponsors/theengs" target="_self" class="nav-link external">
  Sponsor ü§ç
  <!----></a></div> <a href="https://github.com/theengs/gateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for üè†</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisitesüß≠</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/install/install.html" class="sidebar-link">2 - Install ‚úîÔ∏è</a></li><li><a href="/use/use.html" aria-current="page" class="active sidebar-link">3 - Use ‚úàÔ∏è</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/use/use.html#launching-the-gateway" class="sidebar-link">Launching the gateway</a></li><li class="sidebar-sub-header"><a href="/use/use.html#details-options" class="sidebar-link">Details options</a></li><li class="sidebar-sub-header"><a href="/use/use.html#publish-to-a-2-levels-topic" class="sidebar-link">Publish to a 2 levels topic</a></li><li class="sidebar-sub-header"><a href="/use/use.html#scan-every-55-s" class="sidebar-link">Scan every 55 s</a></li><li class="sidebar-sub-header"><a href="/use/use.html#configuration-record" class="sidebar-link">Configuration record</a></li><li class="sidebar-sub-header"><a href="/use/use.html#mqtttomqtt-decoding" class="sidebar-link">MQTTtoMQTT decoding</a></li><li class="sidebar-sub-header"><a href="/use/use.html#home-assistant-auto-discovery" class="sidebar-link">Home Assistant auto discovery</a></li><li class="sidebar-sub-header"><a href="/use/use.html#discovered-device-tracker-timeout" class="sidebar-link">Discovered device tracker timeout</a></li><li class="sidebar-sub-header"><a href="/use/use.html#passive-scanning" class="sidebar-link">Passive scanning</a></li><li class="sidebar-sub-header"><a href="/use/use.html#time-synchronization" class="sidebar-link">Time synchronization</a></li><li class="sidebar-sub-header"><a href="/use/use.html#reading-encrypted-advertisements" class="sidebar-link">Reading encrypted advertisements</a></li><li class="sidebar-sub-header"><a href="/use/use.html#resolving-random-private-addresses" class="sidebar-link">Resolving random private addresses</a></li><li class="sidebar-sub-header"><a href="/use/use.html#getting-identity-resolving-key-irk-for-apple-watch-iphone-and-ipad" class="sidebar-link">Getting Identity Resolving Key (IRK) for Apple Watch, iPhone and iPad</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4 - Participate üíª</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="use"><a href="#use" class="header-anchor">#</a> Use</h1> <h2 id="launching-the-gateway"><a href="#launching-the-gateway" class="header-anchor">#</a> Launching the gateway</h2> <h3 id="for-a-regular-installation"><a href="#for-a-regular-installation" class="header-anchor">#</a> For a regular installation</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;&lt;mqtt_broker_host_ip&gt;&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="for-a-docker-container"><a href="#for-a-docker-container" class="header-anchor">#</a> For a Docker container</h3> <p>To run it with minimum required parameters required:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --rm <span class="token punctuation">\</span>
    --network <span class="token function">host</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_HOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>mqtt_broker_host_ip<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -v /var/run/dbus:/var/run/dbus <span class="token punctuation">\</span>
    --name TheengsGateway <span class="token punctuation">\</span>
    theengs/gateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you've installed your MQTT broker on the same instance as the gateway, you can use <code>localhost</code> as the <code>&lt;mqtt_broker_host_ip&gt;</code>.</p></div> <h3 id="checking-the-data-published-by-the-gateway"><a href="#checking-the-data-published-by-the-gateway" class="header-anchor">#</a> Checking the data published by the gateway</h3> <p>Once the command launched you should see MQTT payloads appearing on the broker. To visualize these data you have to use an <a href="../prerequisites/broker">MQTT client tool</a>.</p> <p><img src="/assets/img/TheengsGateway_mqtt_explorer.beabd93e.png" alt="MQTT"></p> <p>Example payload received:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;F35285&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;F3:52:85&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span><span class="token number">-82</span><span class="token punctuation">,</span><span class="token property">&quot;brand&quot;</span><span class="token operator">:</span><span class="token string">&quot;BlueMaestro&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model&quot;</span><span class="token operator">:</span><span class="token string">&quot;TempoDisc&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;BM_V23&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tempc&quot;</span><span class="token operator">:</span><span class="token number">24.1</span><span class="token punctuation">,</span><span class="token property">&quot;tempf&quot;</span><span class="token operator">:</span><span class="token number">75.38</span><span class="token punctuation">,</span><span class="token property">&quot;hum&quot;</span><span class="token operator">:</span><span class="token number">104.7</span><span class="token punctuation">,</span><span class="token property">&quot;dp&quot;</span><span class="token operator">:</span><span class="token number">24.8</span><span class="token punctuation">,</span><span class="token property">&quot;volt&quot;</span><span class="token operator">:</span><span class="token number">2.56</span><span class="token punctuation">,</span><span class="token property">&quot;mfr&quot;</span><span class="token operator">:</span><span class="token string">&quot;Blue Maestro Limited&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>mfr</code> key has the company name of the manufacturer as its value in two cases:</p> <ul><li>Theengs Gateway has successfully decoded the advertisement of the device, its manufacturer data have a company ID compliant to the Bluetooth specification, and it's no beacon (iBeacon, Microsoft Advertising Beacon).</li> <li>Theengs Gateway isn't able to decode the advertisement of the device.</li></ul> <p>Note that in the latter case, there's guarantee that the manufacturer name is correct, as many devices aren't compliant to the Bluetooth specification and encode their data in the bytes where the manufacturer ID should be.</p> <h2 id="details-options"><a href="#details-options" class="header-anchor">#</a> Details options</h2> <h3 id="for-a-regular-installation-2"><a href="#for-a-regular-installation-2" class="header-anchor">#</a> For a regular installation</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>1technophile<span class="token operator">&gt;</span>python -m TheengsGateway -h
usage: TheengsGateway <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>-a ADAPTER<span class="token punctuation">]</span> <span class="token punctuation">[</span>-b BLE<span class="token punctuation">]</span> <span class="token punctuation">[</span>-bk ADDRESS <span class="token punctuation">[</span>BINDKEY <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-c CONFIG<span class="token punctuation">]</span> <span class="token punctuation">[</span>-D DISCOVERY<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-Df DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-Dh HASS_DISCOVERY<span class="token punctuation">]</span> <span class="token punctuation">[</span>-Dn DISCOVERY_NAME<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-Dt DISCOVERY_TOPIC<span class="token punctuation">]</span> <span class="token punctuation">[</span>-H HOST<span class="token punctuation">]</span> <span class="token punctuation">[</span>-id ADDRESS <span class="token punctuation">[</span>IRK <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-Lt LWT_TOPIC<span class="token punctuation">]</span> <span class="token punctuation">[</span>-ll <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span><span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-P PORT<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p PASS<span class="token punctuation">]</span> <span class="token punctuation">[</span>-pa PUBLISH_ALL<span class="token punctuation">]</span> <span class="token punctuation">[</span>-padv PUBLISH_ADVDATA<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-pr PRESENCE<span class="token punctuation">]</span> <span class="token punctuation">[</span>-prt PRESENCE_TOPIC<span class="token punctuation">]</span> <span class="token punctuation">[</span>-pt PUB_TOPIC<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-s <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-sd SCAN_DURATION<span class="token punctuation">]</span> <span class="token punctuation">[</span>-st SUB_TOPIC<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-tb TIME_BETWEEN<span class="token punctuation">]</span> <span class="token punctuation">[</span>-tf TIME_FORMAT<span class="token punctuation">]</span> <span class="token punctuation">[</span>-tls ENABLE_TLS<span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-ts TIME_SYNC <span class="token punctuation">[</span>TIME_SYNC <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-u <span class="token environment constant">USER</span><span class="token punctuation">]</span>
                      <span class="token punctuation">[</span>-ws ENABLE_WEBSOCKET<span class="token punctuation">]</span>

options:
  -h, --help            show this <span class="token builtin class-name">help</span> message and <span class="token builtin class-name">exit</span>
  -a ADAPTER, --adapter ADAPTER
                        Bluetooth adapter <span class="token punctuation">(</span>e.g. hci1 on Linux<span class="token punctuation">)</span>
  -b BLE, --ble BLE     Enable <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> BLE <span class="token punctuation">(</span>default: <span class="token number">1</span><span class="token punctuation">)</span>
  -bk ADDRESS <span class="token punctuation">[</span>BINDKEY <span class="token punctuation">..</span>.<span class="token punctuation">]</span>, --bindkeys ADDRESS <span class="token punctuation">[</span>BINDKEY <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                        Device addresses and their bindkeys: ADDR1 KEY1 ADDR2 KEY2
  -c CONFIG, --config CONFIG
                        Path to the configuration <span class="token function">file</span> <span class="token punctuation">(</span>default: ~/theengsgw.conf<span class="token punctuation">)</span>
  -D DISCOVERY, --discovery DISCOVERY
                        Enable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> MQTT discovery
  -Df DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span>, --discovery_filter DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                        Device discovery filter list <span class="token keyword">for</span> Home Assistant
  -Dh HASS_DISCOVERY, --hass_discovery HASS_DISCOVERY
                        Enable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> Home Assistant MQTT discovery
                        <span class="token punctuation">(</span>default: <span class="token number">1</span><span class="token punctuation">)</span>
  -Dn DISCOVERY_NAME, --discovery_name DISCOVERY_NAME
                        Device name <span class="token keyword">for</span> Home Assistant
  -Dt DISCOVERY_TOPIC, --discovery-topic DISCOVERY_TOPIC
                        MQTT Discovery topic
  -H HOST, --host HOST  MQTT <span class="token function">host</span> address
  -id ADDRESS <span class="token punctuation">[</span>IRK <span class="token punctuation">..</span>.<span class="token punctuation">]</span>, --identities ADDRESS <span class="token punctuation">[</span>IRK <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                        Identity addresses and their IRKs: ADDR1 IRK1 ADDR2 IRK2
  -Lt LWT_TOPIC, --lwt_topic LWT_TOPIC
                        MQTT LWT topic
  -ll <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span>, --log_level <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span>
                        TheengsGateway log level
  -P PORT, --port PORT  MQTT <span class="token function">host</span> port
  -p PASS, --pass PASS  MQTT password
  -pa PUBLISH_ALL, --publish_all PUBLISH_ALL
                        Publish all <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or only decoded <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> advertisements <span class="token punctuation">(</span>default:
                        <span class="token number">1</span><span class="token punctuation">)</span>
  -padv PUBLISH_ADVDATA, --publish_advdata PUBLISH_ADVDATA
                        Publish advertising and advanced data <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or not <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                        <span class="token punctuation">(</span>default: <span class="token number">0</span><span class="token punctuation">)</span>
  -pr PRESENCE, --presence PRESENCE
                        Enable <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> presence publication <span class="token punctuation">(</span>default: <span class="token number">1</span><span class="token punctuation">)</span>
  -prt PRESENCE_TOPIC, --presence_topic PRESENCE_TOPIC
                        MQTT presence topic
  -pt PUB_TOPIC, --pub_topic PUB_TOPIC
                        MQTT publish topic
  -s <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span>, --scanning_mode <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span>
                        Scanning mode <span class="token punctuation">(</span>default: active<span class="token punctuation">)</span>
  -sd SCAN_DURATION, --scan_duration SCAN_DURATION
                        BLE scan duration <span class="token punctuation">(</span>seconds<span class="token punctuation">)</span>
  -st SUB_TOPIC, --sub_topic SUB_TOPIC
                        MQTT subscribe topic
  -tb TIME_BETWEEN, --time_between TIME_BETWEEN
                        Seconds to <span class="token function">wait</span> between scans
  -tf TIME_FORMAT, --time_format TIME_FORMAT
                        Use <span class="token number">12</span>-hour <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or <span class="token number">24</span>-hour <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">time</span> <span class="token function">format</span> <span class="token keyword">for</span> clocks
                        <span class="token punctuation">(</span>default: <span class="token number">0</span><span class="token punctuation">)</span>
  -tls ENABLE_TLS, --enable_tls ENABLE_TLS
                        Enable <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> TLS <span class="token punctuation">(</span>default: <span class="token number">0</span><span class="token punctuation">)</span>
  -ts TIME_SYNC <span class="token punctuation">[</span>TIME_SYNC <span class="token punctuation">..</span>.<span class="token punctuation">]</span>, --time_sync TIME_SYNC <span class="token punctuation">[</span>TIME_SYNC <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                        Addresses of Bluetooth devices to synchronize the <span class="token function">time</span>
  -to TIME_UNTIL, --tracker_timeout TIME_UNTIL
                        Seconds after <span class="token function">which</span> a discovered device tracker not being received is published as offline/away
                        <span class="token punctuation">(</span>default: <span class="token number">120</span><span class="token punctuation">)</span>
  -u <span class="token environment constant">USER</span>, --user <span class="token environment constant">USER</span>  MQTT username
  -ws ENABLE_WEBSOCKET, --enable_websocket ENABLE_WEBSOCKET
                        Enable <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> WebSocket <span class="token punctuation">(</span>default: <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><h3 id="for-a-docker-container-2"><a href="#for-a-docker-container-2" class="header-anchor">#</a> For a Docker container</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --rm <span class="token punctuation">\</span>
    --network <span class="token function">host</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_HOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>host_ip<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_USERNAME</span><span class="token operator">=</span><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_PASSWORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_PUB_TOPIC</span><span class="token operator">=</span>home/TheengsGateway/BTtoMQTT <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_SUB_TOPIC</span><span class="token operator">=</span>home/+/BTtoMQTT/undecoded <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">PUBLISH_ALL</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">TIME_BETWEEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">SCAN_TIME</span><span class="token operator">=</span><span class="token number">60</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>INFO <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">HAAS_DISCOVERY</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_TOPIC</span><span class="token operator">=</span>homeassistant <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_DEVICE_NAME</span><span class="token operator">=</span>TheengsGateway <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_FILTER</span><span class="token operator">=</span><span class="token string">&quot;[IBEACON,GAEN,MS-CDP,APPLE_CONT,APPLE_CONTAT]&quot;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">SCANNING_MODE</span><span class="token operator">=</span>active <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">ADAPTER</span><span class="token operator">=</span>hci0 <span class="token punctuation">\</span>
    -v /var/run/dbus:/var/run/dbus <span class="token punctuation">\</span>
    --name TheengsGateway <span class="token punctuation">\</span>
    theengs/gateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="publish-to-a-2-levels-topic"><a href="#publish-to-a-2-levels-topic" class="header-anchor">#</a> Publish to a 2 levels topic</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;192.168.1.17&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span> -pt <span class="token string">&quot;home/TheengsGateway&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="scan-every-55-s"><a href="#scan-every-55-s" class="header-anchor">#</a> Scan every 55 s</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;192.168.1.17&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span> -pt <span class="token string">&quot;home/TheengsGateway&quot;</span> -tb <span class="token number">55</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="configuration-record"><a href="#configuration-record" class="header-anchor">#</a> Configuration record</h2> <p>Once you have entered your credentials and parameters, Theengs Gateway saves them into a configuration file <code>theengsgw.conf</code> into your user directory and you can simply launch the gateway by using:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="mqtttomqtt-decoding"><a href="#mqtttomqtt-decoding" class="header-anchor">#</a> MQTTtoMQTT decoding</h2> <p>Theengs Gateway decodes messages with Bluetooth Low Energy (BLE) data sent to the subscribe topic, and publishes the decoded result to the publish topic. This allows for offloading the decode operation from other devices, such as an ESP32, to enhance performance.</p> <p>The data sent to the topic should be in JSON format and must have at least an &quot;id&quot; entry.</p> <p>Example message:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;54:94:5E:9F:64:C4&quot;,
  &quot;mac_type&quot;:1,
  &quot;manufacturerdata&quot;:&quot;4c0010060319247bbc68&quot;,
  &quot;rssi&quot;:-74,
  &quot;txpower&quot;:12
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If possible, the gateway decodes and publishes the data.</p> <p><a href="https://docs.openmqttgateway.com/" target="_blank" rel="noopener noreferrer">OpenMQTTGateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, proposes a <a href="https://docs.openmqttgateway.com/upload/web-install.html" target="_blank" rel="noopener noreferrer">web upload<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> binary <code>esp32dev-ble-mqtt-undecoded</code> that publishes directly to 'home/<gateway name="">/BTtoMQTT` making it directly compatible with Theengs Gateway MQTTtoMQTT decoding feature.</gateway></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default Theengs Gateway listens to <code>home/+/BTtoMQTT/undecoded</code>, if you have several ESP32 gateways with OpenMQTTGateway sending out MQTT messages with undecoded data, Theengs picks up all of them and centralizes the decoded BLE sensor data in one place.</p></div> <h2 id="home-assistant-auto-discovery"><a href="#home-assistant-auto-discovery" class="header-anchor">#</a> Home Assistant auto discovery</h2> <p>If enabled (default), decoded devices publish their configuration to Home Assistant so the latter can discover them.</p> <ul><li>You can enable/disable this with the <code>-D</code> or <code>--discovery</code> command line argument with a value of 1 (enable) or 0 (disable).</li> <li>If you want to use Home Assistant discovery with other home automation gateways such as openHAB, set <code>-Dh</code> or <code>--hass_discovery</code> to 0 (disable).</li> <li>You can set the discovery topic with the <code>-Dt</code> or <code>--discovery_topic</code> command line argument.</li> <li>You can set the discovery name with the <code>-Dn</code> or <code>--discovery_name</code> command line argument.</li> <li>You can filter devices from discovery with the <code>-Df</code> or <code>--discovery_filter</code> argument which takes a list of device model ID to filter.</li></ul> <p>The <code>IBEACON</code> and random MAC devices (<code>APPLE</code>*, <code>MS-CDP</code> and <code>GAEN</code>) aren't discovered as their addresses (IDs) change over time resulting in multiple discoveries.</p> <div class="custom-block tip"><p class="custom-block-title">* INFO</p> <p>Apple Watch, iPhone and iPad are discovered if they're defined with their Identity MAC Address and IRK</p></div> <h2 id="discovered-device-tracker-timeout"><a href="#discovered-device-tracker-timeout" class="header-anchor">#</a> Discovered device tracker timeout</h2> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p><code>-to TIME_UNTIL, --tracker_timeout</code> needs to be at least longer than TIME_BETWEEN + SCAN_DURATION to avoid any unwanted temporary offline status messages for discovered trackers.</p></div> <h2 id="passive-scanning"><a href="#passive-scanning" class="header-anchor">#</a> Passive scanning</h2> <p>Passive scanning (<code>-s passive</code> or <code>--scanning_mode passive</code>) only works on Windows or Linux kernel &gt;= 5.10 and BlueZ &gt;= 5.56 with experimental features enabled.</p> <p>To enable experimental features in BlueZ on a Linux distribution that uses <code>systemd</code>, run the following command:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl edit bluetooth.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then add the following lines:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[Service]
ExecStart=
ExecStart=/usr/lib/bluetooth/bluetoothd --experimental
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>On other Linux variants the path might be slightly different. You can usually see this by the commented out entries of <code>ExecStart=‚Ä¶</code> when editing <code>bluetooth.service</code> or with the <code>which bluetoothd</code> command.</p></div> <p>Save and close the file and then run the following commands:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl daemon-reload
sudo systemctl restart bluetooth.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="time-synchronization"><a href="#time-synchronization" class="header-anchor">#</a> Time synchronization</h2> <p>If you have specified the MAC addresses of <a href="https://bluetooth-clocks.readthedocs.io/en/latest/devices.html" target="_blank" rel="noopener noreferrer">supported Bluetooth clocks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the <code>--time_sync</code> argument, Theengs Gateway automatically synchronizes their time once a day. Therefore, make sure to correctly set your gateway's time.</p> <p>Some Bluetooth clocks let you choose between 12-hour (AM/PM) and 24-hour format to show their time. Use the argument <code>--time_format 0</code> (default) for 24-hour format and <code>--time_format 1</code> for 12-hour format.</p> <p>Note that the first time synchronization of each specified clock happens at a random time in the next day. This way the gateway spaces out connections to these devices in time. After this first time synchronization, Theengs Gateway synchronizes its time every 24 hours.</p> <p>If a device isn't recognized as a supported clock, Theengs Gateway won't try to synchronize its time ever. But if there are other errors, such as connection errors or write errors (which could be temporary), the device is still tried every 24 hours.</p> <p>If you want to know which of your devices Theengs Gateway's time synchronization feature supports, run the following command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bluetooth-clocks discover
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Theengs Gateway installs the <code>bluetooth-clocks</code> command as part of its dependencies.</p> <h2 id="reading-encrypted-advertisements"><a href="#reading-encrypted-advertisements" class="header-anchor">#</a> Reading encrypted advertisements</h2> <p>If you want to read encrypted advertisements, you need to add a bindkey for each device address with the <code>--bindkeys</code> argument. For example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TheengsGateway --bindkeys 00:11:22:33:44:55:66 0dc540f3025b474b9ef1085e051b1add AA:BB:CC:DD:EE:FF 6385424e1b0341109942ad2a6bb42e58
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Theengs Gateway then uses the bindkey <code>0dc540f3025b474b9ef1085e051b1add</code> to decrypt all advertisements from device <code>00:11:22:33:44:55:66</code> and bindkey <code>6385424e1b0341109942ad2a6bb42e58</code> for all advertisements from device <code>AA:BB:CC:DD:EE:FF</code>.</p> <h2 id="resolving-random-private-addresses"><a href="#resolving-random-private-addresses" class="header-anchor">#</a> Resolving random private addresses</h2> <p>If you want to resolve random private addresses into a device's identity address, you need to add an Identity Resolving Key (IRK) for each identity address with the <code>--identities</code> argument. For example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TheengsGateway --identities 00:11:22:33:44:55:66 0dc540f3025b474b9ef1085e051b1add AA:BB:CC:DD:EE:FF 6385424e1b0341109942ad2a6bb42e58
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Theengs Gateway then uses the identity resolving key <code>0dc540f3025b474b9ef1085e051b1add</code> to resolve random private addresses from device <code>00:11:22:33:44:55:66</code> and identity resolving key <code>6385424e1b0341109942ad2a6bb42e58</code> to resolve random private addresses from device <code>AA:BB:CC:DD:EE:FF</code>.</p> <p>You can also specify the identity resolving key as a Base64 encoded string, such as <code>&quot;MGRjNTQwZjMwMjViNDc0YjllZjEwODVlMDUxYjFhZGQ=&quot;</code>.</p> <h2 id="getting-identity-resolving-key-irk-for-apple-watch-iphone-and-ipad"><a href="#getting-identity-resolving-key-irk-for-apple-watch-iphone-and-ipad" class="header-anchor">#</a> Getting Identity Resolving Key (IRK) for Apple Watch, iPhone and iPad</h2> <p>To get the Bluetooth Identity Address of an Apple device go to <em><strong>Settings</strong></em> &gt; <em><strong>General</strong></em> &gt; <em><strong>About</strong></em> on the device and view the MAC address stated under <strong>Bluetooth</strong>.</p> <p>On a Mac associated with your devices open the <strong>Keychain Access</strong> application and search the <strong>login</strong> or <strong>iCloud</strong> Keychain - depending on whether you have iCloud <em>Password and Keychain</em> syncing activated or not - for either Bluetooth or the identity address you got for your device as described previously.</p> <p>When you open the Keychain entry, in the Account field it should confirm the identity address as <code>Public AA:BB:CC:DD:EE:FF</code>.</p> <p>Tick the <strong>Show Password</strong> checkbox and enter your macOS password to then select and copy the <em>whole</em> content of the field. Paste the content into an empty TextEdit document and look for the <strong>Remote IRK</strong>.</p> <p><img src="/assets/img/Theengs-IRK-extraction.8f2154fc.png" alt="Remote IRK retrieval"></p> <p>This remote IRK is used to launch the gateway with the public address of your device tracked.</p> <p>Example:
Public address: 11:22:33:44:55:66
IRK: WERknmckjn51464saa==</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TheengsGateway --identities 11:22:33:44:55:66 WERknmckjn51464saa==
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As a result you can see your device information published in the connected MQTT broker under <code>home/TheengsGateway/BTtoMQTT/112233445566</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{&quot;manufacturerdata&quot;: &quot;2c0q1006191e7v30x6fa&quot;, &quot;id&quot;: &quot;11:22:33:44:55:66&quot;, &quot;rssi&quot;: -42, &quot;brand&quot;: &quot;Apple&quot;, &quot;model&quot;: &quot;Apple iPhone/iPad&quot;, &quot;model_id&quot;: &quot;APPLEDEVICE&quot;, &quot;type&quot;: &quot;TRACK&quot;, &quot;track&quot;: true, &quot;unlocked&quot;: false, &quot;distance&quot;: 0.03341741003670675}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div> <p>You can now enjoy local presence tracking based on your Apple devices.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/theengs/gateway/edit/development/docs/use/use.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/16/2024, 11:36:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/install/install.html" class="prev">
        2 - Install ‚úîÔ∏è
      </a></span> <span class="next"><a href="/participate/adding-decoders.html">
        Adding decoders
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ad8a0d53.js" defer></script><script src="/assets/js/2.ab17224a.js" defer></script><script src="/assets/js/6.b0f7e920.js" defer></script>
  </body>
</html>
